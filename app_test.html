<!DOCTYPE html>
<html lang="ja" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="encoding" content="utf-8">
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="styles/index.css">
        <link rel="stylesheet" href="styles/app-test.css">
        <title>Title of the document</title>
      
    </head>
    <body>
        <div class="container">
            <header class="header-container">
                <div class="header-top">
                    <span class="btn-open" id="js-btn-pause-timer">
                        <img src="images/icon-close.png" width="33" alt="" />
                    </span>
                </div>
                <div class="header-label bg-main text-white text-center">
                    チェックテスト
                </div>
                <div class="header-title text-main text-center">
                    これがタイトルです
                </div>
            </header>
            <div class="main-container">
                <div class="qs__top">
                    <div class="qs-total" id="qs-count">1/10問</div>
                    <div class="qs-progress">
                        <div class="progress-bar">
                            <div class="progress-bar-inner"></div>
                        </div>
                    </div>
                    <div class="qs-timetext" id="timer">残り60秒</div>
                </div>
                <div class="qs-container">
                    <div class="qs-item fadeInRight">
                        <div class="qs__body">
                            <div class="qs-question">
                                <span class="label-default">問題1</span>
                                <div class="question-text">
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime nam reiciendis non cum dignissimos nesciunt, a repudiandae? Eaque quibusdam quae deleniti, voluptatem quos molestias. Consequatur laboriosam fugiat repudiandae doloribus inventore.
                                </div>
                            </div>
                            <div class="qs-answer">
                                <div class="qs-answer__option">
                                    <input id="case-1-1" type="radio" value="A" name="question-1" /> 
                                    <label for="case-1-1" class="qs-answer-item">
                                        <div class="answer-case">A</div>
                                        <div class="answer-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam cumque numquam 
                                        excepturi eius consequuntur iusto enim vero delectus praesentium! Cupiditate, </div>
                                    </label>
                                </div>
                                <div class="qs-answer__option">
                                    <input id="case-1-2" type="radio" value="B" name="question-1" /> 
                                    <label for="case-1-2" class="qs-answer-item">
                                        <div class="answer-case">B</div>
                                        <div class="answer-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam cumque numquam 
                                            excepturi eius consequuntur iusto enim vero delectus praesentium! Cupiditate, </div>
                                    </label>
                                </div>
                                <div class="qs-answer__option">
                                    <input id="case-1-3" type="radio" value="C" name="question-1" /> 
                                    <label for="case-1-3" class="qs-answer-item">
                                        <div class="answer-case">C</div>
                                        <div class="answer-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam cumque numquam 
                                            excepturi eius consequuntur iusto enim vero delectus praesentium! Cupiditate, </div>
                                    </label>
                                </div>
                                <div class="qs-answer__option">
                                    <input id="case-1-4" type="radio" value="D" name="question-1" /> 
                                    <label for="case-1-4" class="qs-answer-item">
                                        <div class="answer-case">D</div>
                                        <div class="answer-text">Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quam minus, sunt maiores tempora porro perspiciatis repudiandae ullam quisquam corporis illo est, pariatur explicabo earum magnam sint. Voluptas neque id repudiandae. </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="qs-item fadeInRight">
                        <div class="qs__body">
                            <div class="qs-question">
                                <span class="label-default">問題2</span>
                                <div class="question-text">
                                    This is question 2. Please choose your answer below
                                </div>
                            </div>
                            <div class="qs-answer">
                                <div class="qs-answer__option">
                                    <input id="case-2-1" type="radio" value="A" name="question-2" /> 
                                    <label for="case-2-1" class="qs-answer-item">
                                        <div class="answer-case">A</div>
                                        <div class="answer-text">
                                            <img src="https://f6-zpcloud.zdn.vn/5572416160253665466/28e1ae75c4cd06935fdc.jpg" alt=""/>
                                        </div>
                                    </label>
                                </div>
                                <div class="qs-answer__option">
                                    <input id="case-2-2" type="radio" value="B" name="question-2" /> 
                                    <label for="case-2-2" class="qs-answer-item">
                                        <div class="answer-case">B</div>
                                        <div class="answer-text">
                                            <img src="https://f6-zpcloud.zdn.vn/5971801452460412793/cc3ebc942a2ce872b13d.jpg" alt="" />
                                        </div>
                                    </label>
                                </div>
                                <div class="qs-answer__option">
                                    <input id="case-2-3" type="radio" value="C" name="question-2" /> 
                                    <label for="case-2-3" class="qs-answer-item">
                                        <div class="answer-case">C</div>
                                        <div class="answer-text">
                                            <img src="https://f7-zpcloud.zdn.vn/801567325593706374/ef55115385eb47b51efa.jpg" alt="" />
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="qs-item fadeInRight">
                        <div class="qs__body">
                            <div class="qs-question">
                                <span class="label-default">問題3</span>
                                <div class="question-text">
                                    This is question 3. Please choose your answer below
                                </div>
                            </div>
                            <div class="qs-answer">
                                <div class="qs-answer__option">
                                    <input id="case-3-1" type="radio" value="A" name="question-3" /> 
                                    <label for="case-3-1" class="qs-answer-item">
                                        <div class="answer-case">A</div>
                                        <div class="answer-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam cumque numquam 
                                        excepturi eius consequuntur iusto enim vero delectus praesentium! Cupiditate, </div>
                                    </label>
                                </div>
                                <div class="qs-answer__option">
                                    <input id="case-3-2" type="radio" value="B" name="question-3" /> 
                                    <label for="case-3-2" class="qs-answer-item">
                                        <div class="answer-case">B</div>
                                        <div class="answer-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam cumque numquam 
                                        excepturi eius consequuntur iusto enim vero delectus praesentium! Cupiditate, </div>
                                    </label>
                                </div>
                                <div class="qs-answer__option">
                                    <input id="case-3-3" type="radio" value="C" name="question-3" /> 
                                    <label for="case-3-3" class="qs-answer-item">
                                        <div class="answer-case">C</div>
                                        <div class="answer-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quibusdam cumque numquam 
                                        excepturi eius consequuntur iusto enim vero delectus praesentium! Cupiditate, </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="fixed-footer">
                    <div class="group-btn">
                        <button class="btn btn--white">閉じる</button>
                        <button class="btn btn--primary" id="js-btn-next-qs">次の問題へ</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal" id="modal-pause-timer">
            <div class="modal-dialog">
                <div class="modal-body">
                    <p class="text-center">チェックテストを続けますか？</p>
                </div>
                <div class="modal-footer text-center">
                    <div class="group-btn">
                        <button class="btn btn--white" id="js-btn-stop">やめる</button>
                        <button class="btn btn--primary" id="js-btn-continue">続ける</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="bubble" id="js-bubble">
            <div class="bubble__inner">
                <div class="bubble__close" id="js-bubble__close">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </div>
                正解の選択肢をタップし、<br>
                次の問題に進みましょう！
            </div>
        </div>
        <!-- <script type = "text/javascript" src="js/app-test.js"></script> -->
        <script type="text/javascript">
                var questionCount = document.getElementById("qs-count");
                var timerEl = document.getElementById("timer");
                var progressBar = document.querySelector('.progress-bar');
                var nextQuestionBtn = document.getElementById("js-btn-next-qs");
                var showResultBtn = document.getElementById("js-btn-show-result");
                var quizItem = document.querySelectorAll(".qs-item");
                var pauseTimerBtn = document.getElementById("js-btn-pause-timer");
                var modalPauseTimer = document.getElementById("modal-pause-timer");
                var resumeTimerBtn = document.getElementById("js-btn-continue");
                var bubble = document.getElementById("js-bubble");
                var closeBubble = document.getElementById("js-bubble__close");

                // GLOBAL VARIABLES
                var storedAnswers = [];
                var result = [];

                var index = 0,
                    countQuestion = 1,
                    quizLength = 0
                    choices = [];
                
                var WARNING_TIME = 10;

                var COLOR_CODES = { 
                    info: {
                        color: "info"
                    },
                    warning: {
                        color: "warning",
                        warning_time: WARNING_TIME
                    },
                }

                var TIME_LIMIT = 60;
                var timePassed = 0;
                var timeLeft = TIME_LIMIT;
                var timerInterval = null;
                var remainingPathColor = COLOR_CODES.info.color;
                
                questionCount.innerHTML = countQuestion  + "/" + quizItem.length + "問";

                function startTimer() { 
                    timerInterval = setInterval(() => { 
                        timePassed = timePassed += 1;
                        timeLeft = TIME_LIMIT - timePassed;
                        timerEl.innerHTML = '残り' +  timeLeft + '秒'; 
                        setProgressTime(timeLeft);
                        if (timeLeft === 30) {
                            bubble.style.display = "block"
                        }
                        if (timeLeft < 1) {
                            if (storeAnswer[index] == null) {
                                nextQuestionBtn.removeAttribute('disabled', '');
                            }
                            disableListAnswer = quizItem[index].querySelectorAll(".qs-answer__option");
                    
                            for(var i = 0; i < disableListAnswer.length; i++) {
                                disableListAnswer[i].classList.add("disabled", "not-allow");
                            }
                            clearInterval(timerInterval);
                        }
                    }, 1000)
                }

                function resumeTimer() {
                    //resume timer
                    startTimer();
                }

                function setProgressTime(timeLeft) {
                    var progressBarWidth = timeLeft * progressBar.offsetWidth / TIME_LIMIT;
                    var { info, warning } = COLOR_CODES

                    progressBar.children[0].style.width = progressBarWidth + "px";
                    if ( timeLeft <= warning.warning_time) {
                        progressBar.children[0].classList.remove(info.color);
                        progressBar.children[0].classList.add(warning.color);
                    }
                }  

                function pauseTimer() {
                    //pause timer
                    clearInterval(timerInterval);
                }

                function resetTimer() {
                    TIME_LIMIT = 60;
                    timePassed = 0;
                    timeLeft = TIME_LIMIT;
                }
                

                function startQuiz() { 
                
                    quizLength = quizItem.length;
                    if (storedAnswers.length != 0) { 
                       storedAnswers.length = 0; 
                    }
                    quizDisplay();
                }
                
                function quizDisplay() {
                    nextQuestionBtn.setAttribute('disabled', '');
                    if (index === quizLength) {
                        return
                    }
                    progressBar.children[0].classList.add('info')
                    progressBar.children[0].classList.remove('warning');
                    for(var item = 0; item < quizLength; item++) {
                        quizItem[item].classList.add("hide");
                    }
                    quizItem[index].classList.remove("hide");

                    var storedAnswer = storedAnswers[index];
                   

                    choices = quizItem[index].querySelectorAll('input')

                    for(var i = 0; i < choices.length; i++) {
                        //if question has been answered already
                        if (storedAnswer) {
                            var id = storedAnswer.id;
                            if (i == id) { 
                                // if question is already answered, id has a value
                                choices[i].setAttribute("checked", "checked");
                            }
                        }
                         //if radiobutton is clicked, the chosen answer is stored in array 
                        choices[i].addEventListener("click", storeAnswer);
                    }
                }
             
                function storeAnswer(e) { 
                    var element = e.target;
                    var answer = {
                        id: element.id,
                        value: element.value || ""
                    }
                    storeAnswer[index] = answer;
                    console.log(storeAnswer[index])
                    if ( storeAnswer[index] !== null) {
                        nextQuestionBtn.removeAttribute('disabled', '');
                    }
                }

                function nextQuestion() {
                    countQuestion++
                    if (countQuestion == quizLength + 1) {
                        console.log("submit")
                      
                        
                    } else {
                        index ++;
                        questionCount.innerHTML = countQuestion + "/" + quizItem.length + "問";
                        quizDisplay()
                    }

                    if(timeLeft > 0) {
                        resetTimer()
                    } else {
                        resetTimer()
                        startTimer()
                    }
                    
                }
           
                nextQuestionBtn.addEventListener("click", nextQuestion)

                pauseTimerBtn.addEventListener("click", function() {
                    modalPauseTimer.style.display = "block";
                    pauseTimer()
                })
                
                resumeTimerBtn.addEventListener("click", function() {
                    modalPauseTimer.style.display = "none";
                    resumeTimer()
                })

                closeBubble.addEventListener("click", function(){
                    bubble.style.display = "none";
                })
                //initial setup
                function inital() { 
                    startTimer()
                    startQuiz()
                }
                inital()
        </script>
    </body>
</html>